# DATA 512 Homework 1
## Author : Saisriram Gurajala
## Contact sgura99@uw.edu with any questions and issues

## Goal

The goal of this project is to explore reproducibility and professionalism in data science. To that end, the project involves the following steps: constructing, analyzing, and publishing a dataset of monthly web views from July 1, 2015 to September 30, 2024 for a list of rare disease articles on wikipedia. 

## Repository Structure 

This github has the following structure, generated through a screenshot fed to ChatGPT:

```
data-512-homework_1/
	├── data/
	│	├── schemas/
	│	│	└── json-schema-rare-disease_monthly_cumulative_2015070100-2024093000.json
	│	├── rare-disease_cleaned.AUG.2024.csv
	│	├── rare-disease_monthly_cumulative_2015070100-2024093000.json
	│	├── rare-disease_monthly_desktop_2015070100-2024093000.json
	│	└── rare-disease_monthly_mobile_2015070100-2024093000.json
	├── libs/
	│	├── notebooks/
	│	│	├── api_request_documentation.ipynb
	│	│	├── combine_api_results_documentation.ipynb
	│	│	├── data_analysis.ipynb
	│	│	└── wp_article_views_example.ipynb
	│	└── src/
	│		├── api_request.py
	│		├── combine_api_results.py
	│		└── run_scripts.sh
	└── imgs/
		├── fewest10_months_articles_mobile_desktop_plot.png
		├── max_average_min_average_plot.png
		└── top10_peak_articles_mobile_desktop_plot.png
	├── logs/
	├── LICENSE
	├── poetry.lock
	├── pyproject.toml
	└── README.md
```

## Data Source, Documentation, and Licensure 

The source data comes from the Wikimedia API, and terms of use for the wikimedia can be found [here](https://foundation.wikimedia.org/wiki/Policy:Terms_of_Use). 

Documentation for the wikimedia API can be found [here](https://doc.wikimedia.org/generated-data-platform/aqs/analytics-api/). 

Portions of the source code were sourced from a notebook created by Dr. David W. McDonald for use in DATA 512 licensed via the [Creative Commons BY](https://creativecommons.org/licenses/by/4.0/). The original, unaltered notebook code is located in the `libs/notebooks` directory. 

The list of pages in the `rare-disease_cleaned.AUG.2024.csv` file found in the data subdirectory in this repo was sourced from a rare disease database from the [National Organization of Rare Diseases](https://rarediseases.org/). 

## Getting Started 

This project, in the interest of reproducibility, manages required packages and package versions using the python poetry package, documentation for which can be found [here](https://python-poetry.org/docs/). More thorough information about using poetry can be found at the link provided, but some brief requirements to use poetry for this project are: 
- some interface for the command line
- python
- the pip utility for installing packages 

Once these requirements are fulfilled, install poetry with pip `pip install poetry`, clone this repo, and run
`poetry install` in the base directory of the repo containing the `pyproject.toml` and `poetry.lock` files. All required packages will be installed into the current environment.

Example commands to run data collection and wrangling can be found in the `run_scripts.sh` file in the `libs/src` subdirectory in the repo. If you would like to run these commands as is, you will need to set up the bash environment variables `local_machine_scripts_directory` and `local_machine_data_directory`. These correspond to the scripts and data directory absolute paths in the local machine version of the repo. These environment variables can be set in your current shell through the command:
`export VARNAME="value"`

## Code Outputs: Intermediate files and Final Outputs

As is, this project generates three data files from the `api_request.py` script calls. One file, the desktop access api request call, is preserved till the end. The mobile-web and mobile-app access request api call results are both deleted after merging with the `combine_api_results.py` script call. The file names listed below are generated into the data subdirectory of this repo.

Intermediate Data files:
- `rare-disease_monthly_mobile-app_2015070100-2024093000.json`
- `rare-disease_monthly-mobile-web_2015070100-2024093000.json`

Final Data Files:
- `rare-disease_monthly_cumulative_2015070100-2024093000.json`
- `rare-disease_monthly_desktop_2015070100-2024093000.json`
- `rare-disease_monthly_mobile_2015070100-2024093000.json`

A sample full JSON Schema for these files can be found in the `/data/schemas` subdirectory. It was generated using the 
[Smart JSON Schema VS Code Extension](https://marketplace.visualstudio.com/items?itemName=FabianReyes.smart-json-schema). 

The following is an adapted excerpt from said schema, which extends to other files generated by the scripts listed above: 

```
{"$schema": "http://json-schema.org/draft-04/schema#",
  "description": "",
  "type": "object",
  "properties": {
    "Klinefelter syndrome": {
      "type": "array",
      "uniqueItems": true,
      "minItems": 1,
      "items": {
        "required": [
          "project",
          "article",
          "granularity",
          "timestamp",
          "agent",
          "views"
        ],
        "properties": {
          "project": {
            "type": "string",
            "minLength": 1
          },
          "article": {
            "type": "string",
            "minLength": 1
          },
          "granularity": {
            "type": "string",
            "minLength": 1
          },
          "timestamp": {
            "type": "string",
            "minLength": 1
          },
          "agent": {
            "type": "string",
            "minLength": 1
          },
          "views": {
            "type": "number"
          }
        }
      }
    }
  }
}
```

These json files have keys corresponding to the article title, with the value being an array of dictionaries each of which correspond to monthly api results for that article. 

Additionally, the `data_analysis.ipynb` notebook in `libs/notebooks` generates image files corresponding to the visualization asks for the project in the `imgs` subdirectory of the repo. The image files are as follows:
- `max_average_min_average_plot.png`
- `top10_peak_articles_mobile_desktop_plot.png`
- `fewest10_months_articles_mobile_desktop_plot.png`

These visualizations correspond to, respectively:
- The maximum and minimum articles by average view across desktop and mobile access modes.
- The Top 10 articles by peak view count across desktop and mobile access modes.
- The 10 articles with fewest monthly data entries across desktop and mobile access modes. 

## Notes and Considerations

This project initially attempted to access the wikimedia api asynchronously through the python packages [aiohttp](https://docs.aiohttp.org/en/stable/) and [asyncio](https://docs.python.org/3/library/asyncio.html). However, we note for future users that the mobile-web and mobile-app access modes seemed especially sensitive to overload of API calls. This sensitivity resulted in several fail outs of api calls, and resulted in rewrite of the api call with the synchronous requests package. Some of the titles have a slash, which need to be escaped using the safe parameter in the urllib call in `api_request.py`script. Additionally, the json objects can be difficult to work with and require some handling. 

